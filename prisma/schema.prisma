// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  engineType = "library"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
  previewFeatures = []
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Rol {
  id        Int      @id @default(autoincrement())
  nombre    String   @unique
  usuarios  Usuario[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Usuario {
  id         Int      @id @default(autoincrement())
  nombre     String
  email      String   @unique
  password   String
  rolId      Int
  rol        Rol      @relation(fields: [rolId], references: [id])
  sucursalId Int?
  sucursal   Sucursal? @relation(fields: [sucursalId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Sucursal {
  id                Int                @id @default(autoincrement())
  nombre            String             @unique
  direccion         String
  usuarios          Usuario[]
  movimientos       Movimiento[]
  fondoCajas        FondoCaja[]
  pedidosEspeciales PedidoEspecial[]
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
}

model FormaDePago {
  id         Int         @id @default(autoincrement())
  nombre     String      @unique
  movimientos Movimiento[]
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
}

model TipoGasto {
  id         Int         @id @default(autoincrement())
  nombre     String      @unique
  movimientos Movimiento[]
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
}

enum MovimientoTipo {
  VENTA
  GASTO
  FONDO_CAJA
}

model Movimiento {
  id            Int            @id @default(autoincrement())
  fecha         DateTime       @default(now())
  descripcion   String
  monto         Float
  tipo          MovimientoTipo
  formaDePagoId Int?           // Solo para ventas
  formaDePago   FormaDePago?   @relation(fields: [formaDePagoId], references: [id])
  tipoGastoId   Int?           // Solo para gastos
  tipoGasto     TipoGasto?     @relation(fields: [tipoGastoId], references: [id])
  sucursalId    Int
  sucursal      Sucursal       @relation(fields: [sucursalId], references: [id])
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model FondoCaja {
  id         Int      @id @default(autoincrement())
  monto      Float
  fecha      DateTime @default(now())
  sucursalId Int
  sucursal   Sucursal @relation(fields: [sucursalId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model PedidoEspecial {
  id          Int      @id @default(autoincrement())
  descripcion String
  monto       Float
  fecha       DateTime @default(now())
  sucursalId  Int
  sucursal    Sucursal @relation(fields: [sucursalId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}